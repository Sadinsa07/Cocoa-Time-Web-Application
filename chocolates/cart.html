<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Cart</title>
    <link rel="stylesheet" href="style.css">
    <!-- Link Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <!-- Top Navigation Bar -->
    <nav class="top-nav">
        <div class="logo">
            <i class="fas fa-cookie-bite"></i> Cocoa Time
        </div>
        <button class="nav-button" onclick="window.location.href='../home/home.html';" title="Home">
            <i class="fas fa-home"></i> Home
        </button>
        <button class="nav-button" onclick="window.location.href='chocos.html';" title="Shop">
            <i class="fas fa-shopping-bag"></i> Shop
        </button>
        <button class="nav-button" onclick="window.location.href='cart.html';" title="My Cart">
            <i class="fas fa-shopping-cart"></i> My Cart
        </button>
    </nav>

    <!-- Cart Content -->
    <div class="cart-container">
        <h1>My Cart ðŸ›’</h1>
        <table id="cart-table">
            <thead>
                <tr>
                    <th>Product</th>
                    <th>Quantity</th>
                    <th>Total</th>
                    <th>Added By</th>
                </tr>
            </thead>
            <tbody>
                <!-- Cart items will be dynamically inserted here -->
            </tbody>
        </table>
        <div class="cart-summary">
            <h3>Total: Rs.<span id="cart-total">0</span></h3>
            <button class="checkout-btn" onclick="checkout()">Checkout</button>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Fetch the cart items when the page loads
            fetch('cart_data.php')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const cartTable = document.getElementById("cart-table").getElementsByTagName('tbody')[0];
                        let grandTotal = 0;

                        // Loop through cart items and display them
                        data.cartItems.forEach(item => {
                            const itemTotal = item.total_price; // The total price for each item (already sent from PHP)
                            grandTotal += itemTotal;

                            const row = cartTable.insertRow();
                            row.innerHTML = `
                                <td>${item.product_name}</td>
                                <td>${item.quantity}</td>
                                <td>Rs.${itemTotal}</td>
                                <td>${item.username}</td>
                            `;
                        });

                        // Update the grand total
                        document.getElementById("cart-total").innerText = "0.00";
                    } else {
                        alert('Failed to load cart data.');
                    }
                })
                .catch((error) => {
                    console.error('Error fetching cart data:', error);
                    alert("Error loading cart data.");
                });
        });

        // Checkout function (for demonstration)
        function checkout() {
            alert("Proceeding to checkout!");
        }
    </script>
</body>
</html>
